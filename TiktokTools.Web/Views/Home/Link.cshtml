
@{
    //ViewBag.Title = "TestAPI";
}

<style>
    .input-group {
        width: 100%;
    }

    .input-group-addon {
        width: 140px !important;
    }

    .col-lg-12 {
        margin-top: 20px
    }
</style>
<script>

    function ajax_sub(id) {
        ajax_stream(id)
    }

    function ajax_stream(id) {
        var formData = new FormData();
        formData.append("link", $('#link').val());
        formData.append("mirror", $('#mirrorData').prop("checked"))
        formData.append("userId", id);
        formData.append("cropType", $('#cropType').val());
        $.ajax({
            url: '/Home/AdjustVideoFromLink',
            type: 'POST',
            processData: false,
            contentType: false,
            responseType: 'application/json',
            data: formData,
            success: function (data) {
                //$('#discussion').append(`<li><a href="${data.Content}">点击下载</a></li>`)
                //$('#btn-sub').prop('disabled', false);

            }
        });
    }
</script>

<div class="container">
    <div class="col-lg-12">
        <div class="input-group col-lg-12">
            <label class="input-group-addon">是否镜像:</label>
            <div class="form-control">
                <input id="mirrorData" type="checkbox" style="height:15px;width:15px" name="mirror" />
            </div>
        </div>
        <div class="input-group col-lg-12">
            <label class="input-group-addon">画面处理方式:</label>
            <div class="form-control">
                <select id="cropType">
                    <option value="0">放大</option>
                    <option value="1">横屏转竖屏+背景模糊</option>
                    <option value="2">竖屏转横屏</option>
                </select>
            </div>
        </div>
        <div class="input-group col-lg-12">
            <label class="input-group-addon">输入要去重的视频链接:</label>
            <input id="link" type="text" style="max-width:100%" class="form-control" />
        </div>
    </div>
    <div class="col-lg-12 text-right"> <input type="button" id="btn-sub" class="btn btn-danger" value="开始去重" /></div>
    <ul id="discussion">
    </ul>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (message) {
                // Add the message to the page.
                $('#discussion').append('<li> ' + htmlEncode(message) + '</li>');
            };

            chat.client.adjustSuccess = function ( link) {
                $('#discussion').append(`<li><a href="${link}" download="adjusted.mp4">点击下载</a></li>`)
                $('#btn-sub').prop('disabled', false);
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#btn-sub').click(function () {
                    $(this).prop('disabled', true);
                    // Clear text box and reset focus for next comment.
                    $('#discussion li').remove();
                    ajax_sub($.connection.hub.id);
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}